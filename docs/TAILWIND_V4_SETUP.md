# Tailwind v4.0 Setup Guide

**Last Updated:** December 28, 2025  
**Applies to:** Projects using Tailwind CSS v4.0+

---

## The Problem

Tailwind v4.0 **does not automatically recognize CSS custom properties** as utilities. While previous versions allowed bracket notation like `bg-[var(--color-primary-500)]`, Tailwind v4.0 requires explicit registration via the `@theme` directive.

### Symptom

Colors defined in CSS variables don't render:

```tsx
// ❌ NOT WORKING in Tailwind v4.0
className="text-[var(--color-primary-400)]"
className="bg-[var(--color-primary-500)]"

// Result: No color applied, element appears gray/default
```

### Root Cause

CSS variables are defined but **not registered** with Tailwind's theme configuration:

```css
/* Generated by design system */
:root {
  --color-primary-400: #34d399;
  --color-primary-500: #10b981;
}

/* But Tailwind v4.0 doesn't see these as utilities! */
```

---

## The Solution

Use the **`@theme` directive** to register CSS variables with Tailwind v4.0.

### Step 1: Add @theme Block

In your main CSS file (e.g., `/styles/globals.css`), add this **after** importing generated tokens:

```css
/**
 * Import generated design tokens
 */
@import '../generated/web.css';

/**
 * Register primary colors with Tailwind v4.0
 */
@theme {
  --color-primary-50: #ecfdf5;
  --color-primary-100: #d1fae5;
  --color-primary-200: #a7f3d0;
  --color-primary-300: #6ee7b7;
  --color-primary-400: #34d399;
  --color-primary-500: #10b981;
  --color-primary-600: #059669;
  --color-primary-700: #047857;
  --color-primary-800: #065f46;
  --color-primary-900: #064e3b;
}

/* Rest of your styles... */
```

**What this does:**
- Tells Tailwind v4.0 these CSS variables should be available as utilities
- Enables both bracket notation AND utility classes
- Registers colors in Tailwind's theme at build time

---

### Step 2: Add Utility Classes (Optional but Recommended)

For cleaner syntax and better reliability, add explicit utility classes:

```css
@layer utilities {
  /* Text Colors */
  .text-primary-300 {
    color: var(--color-primary-300);
  }
  .text-primary-400 {
    color: var(--color-primary-400);
  }
  .text-primary-500 {
    color: var(--color-primary-500);
  }
  .text-primary-600 {
    color: var(--color-primary-600);
  }
  .text-primary-700 {
    color: var(--color-primary-700);
  }
  
  /* Background Colors */
  .bg-primary-50 {
    background-color: var(--color-primary-50);
  }
  .bg-primary-100 {
    background-color: var(--color-primary-100);
  }
  .bg-primary-200 {
    background-color: var(--color-primary-200);
  }
  .bg-primary-300 {
    background-color: var(--color-primary-300);
  }
  .bg-primary-400 {
    background-color: var(--color-primary-400);
  }
  .bg-primary-500 {
    background-color: var(--color-primary-500);
  }
  .bg-primary-600 {
    background-color: var(--color-primary-600);
  }
  .bg-primary-700 {
    background-color: var(--color-primary-700);
  }
  .bg-primary-800 {
    background-color: var(--color-primary-800);
  }
  .bg-primary-900 {
    background-color: var(--color-primary-900);
  }
  
  /* Border Colors */
  .border-primary-200 {
    border-color: var(--color-primary-200);
  }
  .border-primary-300 {
    border-color: var(--color-primary-300);
  }
  .border-primary-500 {
    border-color: var(--color-primary-500);
  }
  .border-primary-600 {
    border-color: var(--color-primary-600);
  }
}
```

**Benefits:**
- **Cleaner syntax:** `text-primary-400` vs `text-[var(--color-primary-400)]`
- **Better IDE support:** Autocomplete works
- **More reliable:** No bracket notation parsing issues
- **Easier to read:** Self-documenting color usage

---

### Step 3: Update Component Code

**Before (not working):**
```tsx
<div className="text-[var(--color-primary-400)] bg-[var(--color-primary-500)]">
  Emerald text on emerald background
</div>
```

**After (working - Option 1: Utility Classes - Recommended):**
```tsx
<div className="text-primary-400 bg-primary-500">
  Emerald text on emerald background
</div>
```

**After (working - Option 2: Bracket Notation):**
```tsx
<div className="text-[var(--color-primary-400)] bg-[var(--color-primary-500)]">
  Emerald text on emerald background
</div>
```

**Recommendation:** Use utility classes (`text-primary-400`) for better developer experience.

---

## Complete Example

Here's a complete `/styles/globals.css` file for Tailwind v4.0:

```css
/**
 * Kahu Design System Tokens
 * Generated from kahu-master-system/design-system.json
 */
@import '../generated/web.css';

/**
 * Register primary colors with Tailwind v4.0 theme system
 */
@theme {
  --color-primary-50: #ecfdf5;
  --color-primary-100: #d1fae5;
  --color-primary-200: #a7f3d0;
  --color-primary-300: #6ee7b7;
  --color-primary-400: #34d399;
  --color-primary-500: #10b981;
  --color-primary-600: #059669;
  --color-primary-700: #047857;
  --color-primary-800: #065f46;
  --color-primary-900: #064e3b;
}

@custom-variant dark (&:is(.dark *));

:root {
  /* Your other root variables */
  --safe-area-inset-top: env(safe-area-inset-top, 0px);
  --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
  /* ... */
}

.dark {
  /* Dark mode variables */
}

@layer utilities {
  /* Primary Color Utilities */
  .text-primary-300 { color: var(--color-primary-300); }
  .text-primary-400 { color: var(--color-primary-400); }
  .text-primary-500 { color: var(--color-primary-500); }
  .text-primary-600 { color: var(--color-primary-600); }
  
  .bg-primary-50 { background-color: var(--color-primary-50); }
  .bg-primary-100 { background-color: var(--color-primary-100); }
  .bg-primary-200 { background-color: var(--color-primary-200); }
  .bg-primary-300 { background-color: var(--color-primary-300); }
  .bg-primary-400 { background-color: var(--color-primary-400); }
  .bg-primary-500 { background-color: var(--color-primary-500); }
  .bg-primary-600 { background-color: var(--color-primary-600); }
  .bg-primary-700 { background-color: var(--color-primary-700); }
  .bg-primary-800 { background-color: var(--color-primary-800); }
  .bg-primary-900 { background-color: var(--color-primary-900); }
  
  .border-primary-200 { border-color: var(--color-primary-200); }
  .border-primary-300 { border-color: var(--color-primary-300); }
  .border-primary-500 { border-color: var(--color-primary-500); }
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }

  body {
    @apply bg-background text-foreground;
  }
}

/* Typography defaults */
@layer base {
  h1 {
    font-size: var(--text-2xl);
    font-weight: var(--font-weight-medium);
    line-height: 1.5;
  }

  p {
    font-size: var(--text-base);
    font-weight: var(--font-weight-normal);
    line-height: 1.5;
  }
}
```

---

## Extending to Other Color Scales

If you want to use **secondary, accent, or semantic colors** as utilities, add them to the `@theme` block:

```css
@theme {
  /* Primary - Emerald */
  --color-primary-400: #34d399;
  --color-primary-500: #10b981;
  
  /* Secondary - Amber */
  --color-secondary-amber-400: #fbbf24;
  --color-secondary-amber-500: #f59e0b;
  
  /* Accent - Purple */
  --color-accent-purple-400: #c084fc;
  --color-accent-purple-500: #a855f7;
  
  /* Semantic */
  --color-success: #10b981;
  --color-warning: #f59e0b;
  --color-error: #ef4444;
  --color-info: #3b82f6;
}
```

Then add utility classes:

```css
@layer utilities {
  /* Secondary Amber */
  .text-secondary-amber-400 { color: var(--color-secondary-amber-400); }
  .bg-secondary-amber-500 { background-color: var(--color-secondary-amber-500); }
  
  /* Accent Purple */
  .text-accent-purple-400 { color: var(--color-accent-purple-400); }
  .bg-accent-purple-500 { background-color: var(--color-accent-purple-500); }
  
  /* Semantic */
  .text-success { color: var(--color-success); }
  .text-warning { color: var(--color-warning); }
  .text-error { color: var(--color-error); }
  .bg-success { background-color: var(--color-success); }
}
```

---

## Verification Checklist

After implementing this setup, verify:

- [ ] Emerald green appears on active navigation items
- [ ] Utility classes like `text-primary-400` work
- [ ] Bracket notation like `bg-[var(--color-primary-500)]` works
- [ ] Light mode renders colors correctly
- [ ] Dark mode renders colors correctly
- [ ] No console warnings about undefined utilities
- [ ] Tailwind compilation succeeds without errors

---

## Common Issues

### Issue 1: Colors Still Not Showing

**Symptoms:**
- Added `@theme` block but colors still don't render
- Console shows no errors

**Solution:**
1. Clear Tailwind build cache: `rm -rf .next` or `rm -rf dist`
2. Restart dev server
3. Hard refresh browser (Cmd+Shift+R / Ctrl+Shift+R)
4. Verify `@theme` block is **after** `@import` but **before** other styles

---

### Issue 2: Utility Classes Don't Autocomplete

**Symptoms:**
- IDE doesn't suggest `text-primary-400`
- Manual typing works but no autocomplete

**Solution:**
1. Install Tailwind CSS IntelliSense extension (VS Code)
2. Add to `.vscode/settings.json`:
   ```json
   {
     "tailwindCSS.experimental.classRegex": [
       ["className\\s*=\\s*[\"'`]([^\"'`]*)[\"'`]", "([^\\s]+)"]
     ]
   }
   ```
3. Restart VS Code

---

### Issue 3: Duplicate Color Definitions

**Symptoms:**
- CSS file has `--color-primary-500` defined twice
- One in `:root`, one in `@theme`

**Solution:**
This is intentional! They serve different purposes:
- **`:root`**: Runtime CSS variable for dynamic usage
- **`@theme`**: Build-time Tailwind theme registration

Both are needed for full functionality.

---

## Migration Guide

### From Tailwind v3 to v4

**Old (Tailwind v3):**
```tsx
// Worked automatically
className="bg-[var(--color-primary-500)]"
```

**New (Tailwind v4):**
```tsx
// Option 1: Utility class (recommended)
className="bg-primary-500"

// Option 2: Bracket notation (requires @theme)
className="bg-[var(--color-primary-500)]"
```

**Steps:**
1. Add `@theme` directive to globals.css
2. Add utility classes in `@layer utilities`
3. Update components to use utility classes
4. Test thoroughly
5. Deploy

---

## Performance Impact

**Build Time:**
- Negligible impact (~10-50ms added to compilation)
- One-time cost per build

**Runtime:**
- Zero impact - CSS variables resolve at browser runtime
- No JavaScript overhead
- Same performance as hardcoded colors

**Bundle Size:**
- Minimal increase (~1-2KB gzipped)
- Utility classes only included if used (Tailwind's tree-shaking)

---

## Best Practices

✅ **DO:**
- Use `@theme` directive for primary colors
- Add utility classes for frequently-used colors
- Use semantic naming (`text-primary-400` not `text-emerald-400`)
- Document color usage in components
- Test both light and dark themes

❌ **DON'T:**
- Mix hardcoded hex colors with token usage
- Duplicate `@theme` blocks in multiple files
- Remove CSS variables from `:root` (both are needed)
- Forget to regenerate tokens after design system updates
- Skip verification after setup

---

## Alternative: Tailwind Config File

If you prefer using `tailwind.config.js` instead of `@theme` directive:

```javascript
// tailwind.config.js
module.exports = {
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#ecfdf5',
          100: '#d1fae5',
          200: '#a7f3d0',
          300: '#6ee7b7',
          400: '#34d399',
          500: '#10b981',
          600: '#059669',
          700: '#047857',
          800: '#065f46',
          900: '#064e3b',
        },
      },
    },
  },
};
```

**Note:** Tailwind v4.0 encourages using `@theme` directive over config files for better performance and simpler setup.

---

## Further Reading

- [Tailwind CSS v4.0 Documentation](https://tailwindcss.com/docs)
- [Tailwind CSS Custom Properties](https://tailwindcss.com/docs/customizing-colors#using-css-variables)
- [@theme Directive](https://tailwindcss.com/docs/adding-custom-styles#using-theme)
- [Kahu Design System README](../README.md)

---

## Support

**Issues with Tailwind v4.0 setup?**
- Check [GitHub Issues](https://github.com/AlexSmeele/kahu-master-system/issues)
- Review [Implementation Guide](./IMPLEMENTATION_GUIDE.md)
- See [Token Reference](./TOKEN_REFERENCE.md)

---

**Last Updated:** December 28, 2025  
**Tailwind Version:** v4.0+  
**Status:** Production Ready ✅
